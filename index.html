<!DOCTYPE html>
<html>
  <head>
    <title>
      AngularJS vulnerability: `angular.copy()` ReDoS
    </title>

    <meta name="author" content="XLTS.dev" />
    <meta
      name="description"
      content="A minimal reproduction of an AngularJS ReDoS vulnerability related to `angular.copy()`."
    />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body>
    <h1>
      <small>Reproduction of AngularJS vulnerability:</small><br />
      <code>angular.copy()</code> ReDoS
    </h1>

    <section class="vulnerability-info-section">
      <h2>Vulnerability information</h2>
      <table class="vulnerability-info-table">
        <tr>
          <th>Type:</th>
          <td><a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">ReDoS</a></td>
        </tr>
        <tr>
          <th>Affected versions:</th>
          <td>>=v1.2.21</td>
        </tr>
        <tr>
          <th>Fixed in version:</th>
          <td><a href="https://xlts.dev/angularjs">XLTS for AngularJS</a> v1.9.1 and v1.5.17</td>
        </tr>
        <tr>
          <th>Description:</th>
          <td>
            A regular expression used by the <a href="https://docs.angularjs.org/api/ng/function/angular.copy"><code>angular.copy()</code></a> utility function to copy <code>RegExp</code> objects is vulnerable to super-linear runtime due to backtracking.
            With a large carefully-crafted input, this can result in catastrophic backtracking and cause a denial of service of the application, also known as a <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">ReDoS attack</a>.
          </td>
        </tr>
      </table>
    </section>

    <section class="repro-instructions-section">
      <h2>Reproduction instructions</h2>
      <p>
        The app below demonstrates the issue by constructing a regular expression from a user-provided pattern and then copying it with <code>angular.copy()</code>.
      </p>
      <p>
        It is essentially the equivalent of:
        <pre>
          angular.copy(new RegExp(userProvidedPattern));
        </pre>
      </p>
      <p>
        <b>Steps:</b>
        <ol>
          <li>
            Set the regular expression pattern to a value containing many characters.
          </li>
          <li>
            You can click one of the available buttons to set the regular expression pattern to a value with many characters.
          </li>
          <li>
            Click the "Copy regular expression" button to trigger <code>angular.copy()</code> to copy the regular expression.<br />
            <blockquote>
              ðŸ“Œ <b>NOTICE:</b>
              <i>The tab will be unresponsive while the regular expression is being copied. The more characters in the regular expression pattern, the longer the tab will remain unresponsive.</i>
            </blockquote>
          </li>
          <li>
            Observe that the time it takes to copy each regular expression increases super-linearly relative to the pattern length.
          </li>
        </ol>
      </p>
    </section>

    <section class="repro-content-section" ng-app="app" ng-controller="AppCtrl as $ctrl">
      <h2>Reproduction</h2>
      <p>
        Set regular expression pattern to value with N characters:<br />
        <button
            ng-repeat="n in [15, 16, 17, 18, 19, 20]"
            ng-click="$ctrl.setRegexPatternWithCharsPowerOf2Exponent(n)">
          2^{{ n }}
        </button>
      </p>
      <p>
        <label>
          Regular expression pattern:
          <input ng-model="$ctrl.regexPattern" />
          (length: {{ $ctrl.regexPattern.length | number }})
        </label>
      </p>
      <p>
        <button class="repro-btn" ng-click="$ctrl.copyRegex()">Copy regular expression</button>
        <span class="repro-duration">Time to copy regular expression: <b>{{ $ctrl.duration }}</b></span>
      </p>
    </section>
  </body>
</html>
